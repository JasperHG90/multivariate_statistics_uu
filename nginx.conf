worker_processes 2;

events {
  worker_connections  4096;  ## Default: 1024
}

http {
        default_type application/octet-stream;
        sendfile     on;
        tcp_nopush   on;
        server_names_hash_bucket_size 128; # this seems to be required for some vhosts


        map $http_upgrade $connection_upgrade {
            default upgrade;
            ''      close;
          }

        server {
                listen 80 default_server;
                listen [::]:80 default_server ipv6only=on;

                root /usr/share/nginx/html;
                index index.html index.htm;

                server_name localhost;

                location /practical/tab1/ {
                        rewrite ^/practical/tab1/(.*)$ /$1 break;
                        proxy_pass http://practical1:8787/;
                        #proxy_redirect off;
                        proxy_redirect http://practical1:8787/ $scheme://$host/practical/tab1/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }
                
                location /practical/tab2/ {
                        rewrite ^/practical/tab2/(.*)$ /$1 break;
                        proxy_pass http://practical2:8787/;
                        #proxy_redirect off;
                        proxy_redirect http://practical2:8787/ $scheme://$host/practical/tab2/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }

                location /practical/tab3/ {
                        rewrite ^/practical/tab3/(.*)$ /$1 break;
                        proxy_pass http://practical3:8787/;
                        #proxy_redirect off;
                        proxy_redirect http://practical3:8787/ $scheme://$host/practical/tab3/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }
                
                location /practical/tab4/ {
                        rewrite ^/practical/tab4/(.*)$ /$1 break;
                        proxy_pass http://practical4:8787/;
                        #proxy_redirect off;
                        proxy_redirect http://practical4:8787/ $scheme://$host/practical/tab4/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }
                
                location /practical/tab5/ {
                        rewrite ^/practical/tab5/(.*)$ /$1 break;
                        proxy_pass http://practical5:8787/;
                        #proxy_redirect off;
                        proxy_redirect http://practical5:8787/ $scheme://$host/practical/tab5/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }

                location /practical/tab6/ {
                        rewrite ^/practical/tab6/(.*)$ /$1 break;
                        proxy_pass http://practical6:8787/;
                        #proxy_redirect off;
                        proxy_redirect http://practical6:8787/ $scheme://$host/practical/tab6/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }
                
                location /practical/tab7/ {
                        rewrite ^/practical/tab7/(.*)$ /$1 break;
                        proxy_pass http://practical7:8787/;
                        #proxy_redirect off;
                        proxy_redirect http://practical7:8787/ $scheme://$host/practical/tab7/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }
                
                location /practical/tab8/ {
                        rewrite ^/practical/tab8/(.*)$ /$1 break;
                        proxy_pass http://practical8:8787/;
                        #proxy_redirect off;
                        proxy_redirect http://practical8:8787/ $scheme://$host/practical/tab8/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }

                location /practical/tab9/ {
                        rewrite ^/practical/tab9/(.*)$ /$1 break;
                        proxy_pass http://practical9:8787/;
                        #proxy_redirect off;
                        proxy_redirect http://practical9:8787/ $scheme://$host/practical/tab9/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }
                
                location /practical/jerry/ {
                        rewrite ^/practical/jerry/(.*)$ /$1 break;
                        proxy_pass http://jerry:8787/;
                        proxy_redirect http://jerry:8787/ $scheme://$host/practical/jerry/;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
                        proxy_read_timeout 20d;
                }

                location ~ /\.ht {
                        deny all;
                }
        }
}